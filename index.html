<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√∂klerin Mirasƒ± - Prototip V2</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #000; }
        canvas { display: block; }

        /* Aray√ºz Elemanlarƒ± */
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; color: white; }
        
        /* Can Barƒ± */
        #health-container { position: absolute; bottom: 30px; left: 30px; width: 250px; height: 25px; background: rgba(0,0,0,0.6); border: 2px solid #fff; }
        #health-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff4b2b, #ff416c); transition: width 0.3s; }

        /* Mini Map */
        #mini-map { position: absolute; top: 20px; right: 20px; width: 160px; height: 160px; background: rgba(0,0,0,0.5); border: 3px solid #ffd700; border-radius: 50%; overflow: hidden; }
        #player-dot { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); }

        /* Envanter */
        #inventory { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 350px; background: rgba(20,20,20,0.95); border: 2px solid #00d2ff; display: none; pointer-events: auto; padding: 20px; border-radius: 15px; }
        .item-slot { display: inline-block; width: 70px; height: 70px; background: rgba(255,255,255,0.1); margin: 5px; border-radius: 10px; text-align: center; line-height: 70px; font-size: 12px; }

        /* Dialog ve Mesajlar */
        #msg { position: absolute; bottom: 150px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); padding: 10px 30px; border-radius: 20px; font-size: 18px; display: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; background: white; border-radius: 50%; transform: translate(-50%, -50%); opacity: 0.5; }

        /* Saat G√∂stergesi */
        #clock { position: absolute; top: 20px; left: 20px; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px #000; }
    </style>
</head>
<body>

<div id="ui">
    <div id="clock">Saat: 12:00</div>
    <div id="crosshair"></div>
    <div id="msg">Etkile≈üim i√ßin [F] tu≈üuna bas</div>
    
    <div id="mini-map"><div id="player-dot"></div></div>

    <div id="health-container">
        <div id="health-bar"></div>
        <div style="position:absolute; top:0; width:100%; text-align:center; font-size:14px; font-weight:bold;">YA≈ûAM ENERJƒ∞Sƒ∞</div>
    </div>

    <div id="inventory">
        <h2 style="margin-top:0; color:#00d2ff;">G√∂klerin Envanteri</h2>
        <hr border="1" color="#333">
        <div class="item-slot">üçé Elma</div>
        <div class="item-slot">üó°Ô∏è Kƒ±lƒ±√ß</div>
        <div class="item-slot">üóùÔ∏è Anahtar</div>
        <p style="font-size: 12px; color: #aaa;">Yemek yemek i√ßin tƒ±kla (Sim√ºlasyon)</p>
        <button onclick="toggleInventory()" style="margin-top: 50px; width: 100%; padding: 10px; cursor: pointer;">Kapat</button>
    </div>
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

    // --- TEMEL AYARLAR ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    // --- D√úNYA VE G√ñRSEL KALƒ∞TE ---
    scene.background = new THREE.Color(0x87ceeb);
    scene.fog = new THREE.FogExp2(0x87ceeb, 0.002);

    // Zemin
    const floorGeo = new THREE.PlaneGeometry(2000, 2000);
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x2d4c1e, roughness: 0.8 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // I≈üƒ±klandƒ±rma
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);

    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(100, 200, 100);
    sun.castShadow = true;
    sun.shadow.camera.left = -200;
    sun.shadow.camera.right = 200;
    sun.shadow.camera.top = 200;
    sun.shadow.camera.bottom = -200;
    scene.add(sun);

    // --- NESNELER (EVLER, NPC, YATAK) ---
    function createStructure(x, z, type) {
        const group = new THREE.Group();
        
        // Ev G√∂vdesi
        const body = new THREE.Mesh(new THREE.BoxGeometry(8, 6, 8), new THREE.MeshStandardMaterial({ color: 0x5d4037 }));
        body.position.y = 3;
        body.castShadow = true;
        group.add(body);

        // √áatƒ±
        const roof = new THREE.Mesh(new THREE.ConeGeometry(7, 4, 4), new THREE.MeshStandardMaterial({ color: 0x3e2723 }));
        roof.position.y = 8;
        roof.rotation.y = Math.PI / 4;
        group.add(roof);

        // Yatak (Eƒüer i√ßindeyse)
        if(type === 'home') {
            const bed = new THREE.Mesh(new THREE.BoxGeometry(2, 0.5, 4), new THREE.MeshStandardMaterial({ color: 0xffffff }));
            bed.position.set(2, 0.5, 2);
            group.add(bed);
        }

        group.position.set(x, 0, z);
        scene.add(group);
    }

    // Evler ve NPC
    createStructure(20, -20, 'home');
    createStructure(-30, -50, 'storage');

    const npc = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1, 4, 8), new THREE.MeshStandardMaterial({ color: 0x00ffcc }));
    npc.position.set(10, 1, -10);
    scene.add(npc);

    // --- KONTROLLER ---
    const controls = new PointerLockControls(camera, document.body);
    document.addEventListener('click', () => { if(document.getElementById('inventory').style.display !== 'block') controls.lock(); });

    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let velocity = new THREE.Vector3();
    let direction = new THREE.Vector3();
    let health = 100;
    let isNight = false;
    let dayTime = 0; // 0 to 1200 (20 minutes)

    document.addEventListener('keydown', (e) => {
        switch(e.code) {
            case 'KeyW': moveForward = true; break;
            case 'KeyS': moveBackward = true; break;
            case 'KeyA': moveLeft = true; break;
            case 'KeyD': moveRight = true; break;
            case 'KeyE': toggleInventory(); break;
            case 'KeyF': interact(); break;
        }
    });

    document.addEventListener('keyup', (e) => {
        switch(e.code) {
            case 'KeyW': moveForward = false; break;
            case 'KeyS': moveBackward = false; break;
            case 'KeyA': moveLeft = false; break;
            case 'KeyD': moveRight = false; break;
        }
    });

    // Zoom
    let zoomLevel = 5;
    document.addEventListener('wheel', (e) => {
        zoomLevel += e.deltaY * 0.01;
        zoomLevel = Math.max(1, Math.min(10, zoomLevel));
        camera.fov = 75 + zoomLevel; 
        camera.updateProjectionMatrix();
    });

    function toggleInventory() {
        const inv = document.getElementById('inventory');
        if (inv.style.display === 'none' || inv.style.display === '') {
            inv.style.display = 'block';
            controls.unlock();
        } else {
            inv.style.display = 'none';
            controls.lock();
        }
    }

    function interact() {
        // NPC veya Yatak ile mesafe kontrol√º (Basitle≈ütirilmi≈ü)
        const distToNPC = camera.position.distanceTo(npc.position);
        if(distToNPC < 5) {
            alert("B√ºy√ºk Bilge: G√∂klerin mirasƒ±nƒ± arƒ±yorsan, gece √ß√∂kt√ºƒü√ºnde uyanƒ±k kalmalƒ±sƒ±n!");
        }
        
        // Ev i√ßindeki yatak sim√ºlasyonu
        if(camera.position.x > 18 && camera.position.x < 25 && camera.position.z < -18) {
            alert("Uyudun ve sabah oldu...");
            dayTime = 0; // Zamanƒ± sƒ±fƒ±rla (Sabah yap)
        }
    }

    // --- OYUN D√ñNG√úS√ú ---
    const clock = new THREE.Clock();
    
    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();

        if (controls.isLocked) {
            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;

            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize();

            if (moveForward || moveBackward) velocity.z -= direction.z * 60.0 * delta;
            if (moveLeft || moveRight) velocity.x -= direction.x * 60.0 * delta;

            controls.moveRight(-velocity.x * delta);
            controls.moveForward(-velocity.z * delta);
            
            // Yer√ßekimi ve Zemin Korumasƒ±
            camera.position.y = 1.7; 
        }

        // Gece-G√ºnd√ºz D√∂ng√ºs√º (20 Dakika Ayarƒ±)
        dayTime += delta;
        const cycleSeconds = 1200; // 20 dakika
        const progress = (dayTime % cycleSeconds) / cycleSeconds;
        
        // G√ºne≈ü Hareketi
        const angle = progress * Math.PI * 2;
        sun.position.y = Math.sin(angle) * 200;
        sun.position.x = Math.cos(angle) * 200;
        sun.intensity = Math.max(0, Math.sin(angle) * 1.5);

        // G√∂ky√ºz√º Rengi
        if(Math.sin(angle) < 0) {
            scene.background.setHex(0x020205);
            scene.fog.color.setHex(0x020205);
            document.getElementById('clock').innerText = "Gece";
        } else {
            scene.background.setHex(0x87ceeb);
            scene.fog.color.setHex(0x87ceeb);
            document.getElementById('clock').innerText = "G√ºnd√ºz";
        }

        // Can Barƒ± Sim√ºlasyonu (Acƒ±kma)
        if(health > 0) {
            health -= 0.01 * delta;
            document.getElementById('health-bar').style.width = health + "%";
        }

        renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
